<div class="container-block without-tab-bar">
  <app-page-intro>
    <ng-container page-title>Exchange overview</ng-container>
    <ng-container page-content>
      Exchange your Bitcoin and/or altcoins efforlessly for PART and browse your previous exchanges.
    </ng-container>
    <ng-container page-help>
      <!-- FIXME: button should point to exchange-bots -->
      To enable exchange functionality, you will need at least one active Exchange Bot &ndash; manage them in <button mat-button class="small" routerLink="bots"><mat-icon fontIcon="part-tool"></mat-icon>Exchange Bots</button>
    </ng-container>
  </app-page-intro>

  <!-- Listings > Filter -->
  <div class="filter">

    <div class="buttons">
      <!-- FIXME: button should point to new-exchange -->
      <button mat-raised-button color="primary" routerLink="new" class="full-width">
        <mat-icon fontIcon="part-swap"></mat-icon>
        Start new Exchange
      </button>
    </div><!-- .buttons -->

    <!--h2 class="section-title">
      Search
    </h2>

    <mat-card class="filter-card">

      <mat-form-field class="--plain" appearance="fill">
        <input matInput type="text" placeholder="Search Exchanges" [(ngModel)]="filters.search">
        <button *ngIf="filters.search" matSuffix mat-button class="small" (click)="filters.search=''; clearAndLoadPage()" matTooltip="Clear" matTooltipPosition="after">
          <mat-icon fontIcon="part-clear-all"></mat-icon>
        </button>
        <mat-icon *ngIf="!filters.search" matSuffix fontIcon="part-search"></mat-icon>
      </mat-form-field>

    </mat-card--><!-- .filter-card -->

    <h2 class="section-title">
      Filter
    </h2>

    <mat-card class="filter-card">
      <mat-form-field class="--plain" appearance="fill">
        <mat-select placeholder="All input coins" [(ngModel)]="filters.sort" (selectionChange)="filter()">
          <mat-option value="all">All input coins</mat-option>
          <mat-option class="coin-filter-option" *ngFor="let coin of supported_coins" [value]="coin.value">
            <img src="./assets/app-exchange/coins/{{ coin.value.toUpperCase() }}.svg" alt="{{ coin.title }}" class="icon">
            {{ coin.title }} <small>({{ coin.value.toUpperCase() }})</small>
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="--plain" appearance="fill">
        <mat-select placeholder="All output coins" [(ngModel)]="filters.sort" (selectionChange)="filter()">
          <mat-option value="all">All output coins</mat-option>
          <mat-option class="coin-filter-option" *ngFor="let coin of supported_coins" [value]="coin.value">
            <img src="./assets/app-exchange/coins/{{ coin.value.toUpperCase() }}.svg" alt="{{ coin.title }}" class="icon">
            {{ coin.title }} <small>({{ coin.value.toUpperCase() }})</small>
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-radio-group class="radio-group block-radio" [(ngModel)]="filters.hashItems" (change)="clearAndLoadPage()">
        <mat-radio-button class="filter-option" *ngFor="let status of exchange_status" value="{{ status.value }}" color="accent">
          {{ status.title }}
          <span class="amount">{{ status.amount }}</span>
        </mat-radio-button>
      </mat-radio-group>
    </mat-card><!-- .filter-card -->

    <button mat-button color="basic" class="clear-filters" (click)="clear()">
      <mat-icon fontIcon="part-clear-all"></mat-icon>
      Clear all filters
    </button>

  </div><!-- .filter -->



  <!-- Orders > list -->
  <div class="orders section with-filter">

    <div class="exchange-list test-case-container" fxFlex="0 1 100%"
      (scrolled)="loadNextPage()"><!-- infiniteScroll
        [infiniteScrollContainer]="pagination.infinityScrollSelector"
        [fromRoot]="true"
        [infiniteScrollDistance]="2"
        [infiniteScrollThrottle]="50" -->

      <!-- .loading-container -->
      <div class="loading-container" *ngIf="isLoading">
        <div class="loading-info">
          <div class="loading-image">
            <img src="./assets/particl-logo-symbol.svg">
          </div>
          <p class="title">
            Hang on, we're loading the exchanges
          </p>
          <p class="widget-help">
            This might take a while
          </p>
        </div>
      </div><!-- .loading-container -->


      <ng-container><!-- *ngFor="let page of pages; let pageIndex = index;" -->
        <mat-expansion-panel class="exchange order list-item no-padding"><!-- *ngFor="let exchange of page.exchanges; trackBy: trackByFn" -->
          <mat-expansion-panel-header class="header">
            <div class="header-wrapper" fxLayout="row" fxLayoutAlign="space-between center">

              <div class="photo">
                <img src="{{ exchange.bot.image }}">
              </div>

              <div class="meta" fxFlex="1 1 100%">
                <div class="name">
                  <img class="coin" src="./assets/app-exchange/coins/{{ exchange?.currency_from.toUpperCase() }}.svg">
                  {{ exchange?.amount_from | particlAmount }} {{ exchange?.currency_from.toUpperCase() }}
                  -&gt;
                  <img class="coin" src="./assets/app-exchange/coins/{{ exchange?.currency_to.toUpperCase() }}.svg">
                  ~{{ exchange?.amount_to | particlAmount }} {{ exchange?.currency_to.toUpperCase() }}
                </div>
                
                <mat-spinner class="loading-spinner" [diameter]="16" color="accent"></mat-spinner><!-- *ngIf="updateInProgress[exchange.track_id]" -->
                <button mat-button class="exchange-status" (click)="requestUpdate($event, exchange, pageIndex)" matTooltip="Request status update"><!-- [disabled]="updateInProgress[exchange.track_id]" *ngIf="!exchange.tx_to && !updateInProgress[exchange.track_id]" -->
                  <mat-icon class="icon" fontSet="partIcon" fontIcon="part-refresh"></mat-icon>
                  {{ exchange?.status }}
                </button>
                <span class="completed exchange-status" *ngIf="exchange.tx_to">
                  <mat-icon class="icon" fontSet="partIcon" fontIcon="part-check"></mat-icon>
                  {{ exchange?.status }}
                </span>

                <div class="bot-name">{{ exchange.bot.name }}</div>
              </div><!-- .meta -->

            </div>
          </mat-expansion-panel-header>
        
          <div class="detail">
            <table class="exchange-details outgoing full-width">
              <tr>
                <td rowspan="2" class="direction-img">
                  <img src="./assets/app-exchange/coins/{{ exchange?.currency_from.toUpperCase() }}.svg" class="coin">
                  <mat-icon class="icon" fontSet="partIcon" fontIcon="part-arrow-right"></mat-icon>
                </td>
                <th>Send {{ exchange?.currency_from.toUpperCase() }} to</th>
                <td>
                  <mat-spinner class="tiny" color="accent" *ngIf="!exchange.tx_from"></mat-spinner>
                  <input type="text" readonly value="{{ exchange?.address_from }}" class="value highlight address">
                </td>
              </tr>
              <tr>
                <th>Sent TXID ({{ exchange?.currency_from.toUpperCase() }})</th>
                <td><input type="text" readonly value="{{ exchange?.tx_from }}" class="value address txid"></td>
              </tr>
            </table>
            <mat-divider></mat-divider>
            <table class="exchange-details incoming full-width">
              <tr>
                <td rowspan="2" class="direction-img">
                  <mat-icon class="icon" fontSet="partIcon" fontIcon="part-arrow-right"></mat-icon>
                  <img src="./assets/app-exchange/coins/{{ exchange?.currency_to.toUpperCase() }}.svg" class="coin">
                </td>
                <th>Receive {{ exchange?.currency_to.toUpperCase() }} to</th>
                <td><input type="text" readonly value="{{ exchange?.address_to }}" class="value highlight address"></td>
              </tr>
              <tr>
                <th>Received TXID ({{ exchange?.currency_to.toUpperCase() }})</th>
                <td><input type="text" readonly value="{{ exchange?.tx_to }}" class="value address txid"></td>
              </tr>
            </table>

            <mat-divider></mat-divider>

            <div class="row" fxLayoutGap="30px" fxLayoutAlign="space-between center">
              <table class="exchange-details full-width" fxFlex="1 1 100%">
                <tr>
                  <th>Exchange Created</th>
                  <td><input type="text" disabled value="{{ formatDate(exchange?.created_date) }}" class="value address"></td>
                </tr>
                <tr>
                  <th>Exchange Updated</th>
                  <td><input type="text" disabled value="{{ formatDate(exchange?.updated_date) }}" class="value address"></td>
                </tr>
                <tr>
                  <th>Exchange ID</th>
                  <td><input type="text" readonly value="{{ exchange?.track_id }}" class="value address exchange-id"></td>
                </tr>
              </table>
              <div class="exchange-actions" fxFlex="0 0 100px">
                <button mat-button color="warn" matTooltip="Cancel this Exchange" (click)="cancelExchange(exchange?.track_id, pageIndex)"><!-- *ngIf="!exchange.tx_from" -->
                  <mat-icon class="icon" fontSet="partIcon" fontIcon="part-circle-remove"></mat-icon>
                  Cancel
                </button>
              </div>
            </div>

          </div><!-- .detail -->

        </mat-expansion-panel>
      </ng-container>


      <div class="no-results"><!-- *ngIf="pages[0]?.exchanges.length === 0" -->
        <img class="illustration" src="./assets/app-exchange/illustrations/no-exchanges.svg" alt="No past Exchanges found">
        <p>
          No past Exchanges found
        </p>
        <p class="help-text">
          You don't have any matching past Exchanges &ndash; why don't you start a new one?
        </p>
      </div><!-- .no-results -->

    </div>
  </div><!-- .orders.list -->



</div><!-- .container-block -->
