<div class="container-block">
  <mat-horizontal-stepper [@.disabled]="true" [linear]="true" class="no-bg container-block" #stepper>
    <!-- Overwrite default Stepper icons: https://material.angular.io/components/stepper/overview#overriding-icons -->
    <ng-template matStepperIcon="edit">
      <custom-icon>
        <mat-icon class="icon" fontSet="partIcon" fontIcon="part-check"></mat-icon>
      </custom-icon>
    </ng-template>
    <ng-template matStepperIcon="done">
      <custom-icon>
        <mat-icon class="icon" fontSet="partIcon" fontIcon="part-pen-1"></mat-icon>
      </custom-icon>
    </ng-template>

    <!-- =========== SELECT IMPORT =========== -->
    <mat-step [completed]="stepper.selectedIndex >= 1">
      <ng-template matStepLabel>Select Import</ng-template>

      <mat-tab-group (selectedTabChange)="tabChange($event);" animationDuration="0ms">
        <mat-tab *ngFor="let import of filterImportsByNetwork" label="{{import.name}}">
          <h2 class="subtitle">Import product file</h2>
          <mat-card [formGroup]="import.form" [ngSwitch]="import.id" class="import-file">
            <!-- Customized CSV UI -->
            <ng-container *ngSwitchCase="'csv-import'">
              <app-import-custom-ui-csv [import]="import" (clear)="clearOldValues()"></app-import-custom-ui-csv>
            </ng-container>
    
            <!-- Customized Woocommerce UI -->
            <ng-container *ngSwitchCase="'woocommerce-import'">
              <app-import-custom-ui-woocommerce [import]="import" (clear)="clearOldValues()"></app-import-custom-ui-woocommerce>
            </ng-container>
    
            <!-- Customized Ebay Scraper UI -->
            <ng-container *ngSwitchCase="'ebay-testnet-scraper'">
              <app-import-custom-ui-ebay-scraper [import]="import" (clear)="clearOldValues()"></app-import-custom-ui-ebay-scraper>
            </ng-container>
    
            <!-- Dynamic Fallback UI -->
            <ng-container *ngSwitchDefault>
              <h3 class="box-title">{{import.description}}</h3>
              <div *ngFor="let param of import.params" [ngSwitch]="param.type">
                <mat-form-field *ngSwitchCase="'text'"
                                [formGroup]="import.form">
                  <input matInput [formControlName]="param.name" [placeholder]="param.message" [type]="param.type" (change)="clearOldValues()">
                </mat-form-field>
    
                <mat-form-field *ngSwitchCase="'number'"
                                [formGroup]="import.form">
                  <input matInput min="0" (paste)="numericValidator($event)" (keypress)="numericValidator($event)" 
                        [formControlName]="param.name" [placeholder]="param.message" (change)="clearOldValues()"
                        type="text">
                </mat-form-field>
    
                <mat-form-field *ngSwitchCase="'file'"
                                [formGroup]="import.form">
                  <ngx-mat-file-input [formControlName]="param.name" [placeholder]="param.message" [accept]="param.fileType" (change)="clearOldValues()"></ngx-mat-file-input>
                </mat-form-field>
              </div>
            </ng-container>
        
            <span *ngIf="importError">{{ importError }}</span>
          </mat-card>

          <div class="action-buttons" fxLayoutAlign="end center" fxLayoutGap="8px">
            <button mat-raised-button color="primary" [disabled]="!import.form.valid" (click)="importLoad(import)">
              <mat-icon class="icon" fontSet="partIcon" fontIcon="part-next-single"></mat-icon>
              Load
            </button>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-step>

    <!-- =========== REVIEW IMPORT =========== -->
    <mat-step [completed]="stepper.selectedIndex >= 2">
      <ng-template matStepLabel>Review Import Data</ng-template>
      <mat-accordion *ngIf="listings.length > 0">
        <h2 class="subtitle">Products found for import</h2>
        <p>Based on your product file, we've found these Products for import. Review and update their missing information, like shipping prices and categories.</p>
        <app-import-listing *ngFor="let listing of listings" [listing]="listing" (onChange)="clearEstimate()"></app-import-listing>
      </mat-accordion> 

      <div class="action-buttons" fxLayoutAlign="space-between center" fxLayoutGap="8px">
        <button mat-button matStepperPrevious>
          <mat-icon class="icon" fontSet="partIcon" fontIcon="part-previous-single"></mat-icon>
          Back
        </button>
        <button mat-raised-button color="primary" [disabled]="!canShip" (click)="nextStep()">
          <mat-icon class="icon" fontSet="partIcon" fontIcon="part-next-single"></mat-icon>
          Continue to shipping
        </button>
      </div>
    </mat-step>

    <!-- =========== SHIPPING & EXPIRATION =========== -->
    <mat-step [completed]="stepper.selectedIndex >= 3">
      <ng-template matStepLabel>Shipping & Expiration</ng-template>

      <h2 class="subtitle">Shipping &amp; Listing expiration</h2>
      <mat-card>
        <h3 class="box-title">Shipping</h3>
        <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="30px">
    
          <mat-select-search
            fxFlex="1 1 30%"
            class="full-width"
            [options]="countryList.getList()"
            [showValueOf]="'name'"
            [placeHolder]="'Shipping from (your country)'"
            [isRequired]="'true'"
            [isLexigraphicalOrder]="true"
            [defaultSelectedValue]="selectedCountry"
            (onChange)="onCountryChange($event)">
          </mat-select-search>
          <div class="desc" fxFlex="1 1 70%">
            <p>
              Select your country, from which you will ship your products.
            </p>
            <p class="widget-help">
              Domestic shipping rate will apply for selected country. For all other countries, international shipping rates will be applied.
            </p>
          </div><!-- .desc -->
    
        </div>
    
        <h3 class="box-title">Listing expiration &amp; fees</h3>
        <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="30px">
    
          <mat-form-field class="full-width" fxFlex="1 1 30%">
            <mat-label>Select expiry time</mat-label>
            <mat-select [(value)]="selectedExpiration" (selectionChange)="clearEstimate()">
              <mat-option>None</mat-option>
              <mat-option [disabled]="expire?.isDisabled" *ngFor="let expire of expiredList" [value]="expire.value">
                {{ expire.title }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <div class="desc" fxFlex="1 1 70%">
            <p>
              How long should the imported Listings be published on the Open Marketplace?
            </p>
            <p class="widget-help">
              Listing(s) publishing fee increases linearly for each published day. After this period, Listings will expire and you will need to re-publish them again.
            </p>
          </div><!-- .desc -->
    
        </div>
      </mat-card>
    
    
      <div class="action-buttons" fxLayout fxLayoutGap="30px" fxLayoutAlign="space-between center">
        <button mat-button matStepperPrevious>
          <mat-icon class="icon" fontSet="partIcon" fontIcon="part-previous-single"></mat-icon>
          Back
        </button>
        <button mat-raised-button color="primary" [disabled]="!canEstimate" (click)="estimateFee()">
          <mat-icon class="icon" fontSet="partIcon" fontIcon="part-next-single"></mat-icon>
          Estimate Fee
        </button>
      </div><!-- .action-buttons -->      
    </mat-step>

    <!-- =========== PUBLISH =========== -->
    <mat-step [completed]="stepper.selectedIndex >= 4">
      <ng-template matStepLabel>Publish</ng-template>

      <table mat-table [dataSource]="filterListingsByPublished" class="table-full-width">
        <!-- Title Column -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>Title</th>
          <td mat-cell *matCellDef="let listing"> {{listing.title}} </td>
        </ng-container>

        <!-- Price Column -->
        <ng-container matColumnDef="basePrice">
          <th mat-header-cell *matHeaderCellDef>Price</th>
          <td mat-cell *matCellDef="let listing"> {{listing.basePrice}} </td>
        </ng-container>

        <!-- Shipping Column -->
        <ng-container matColumnDef="domesticShippingPrice">
          <th mat-header-cell *matHeaderCellDef>Domestic Shipping</th>
          <td mat-cell *matCellDef="let listing"> {{listing.domesticShippingPrice}} </td>
        </ng-container>

        <!-- Intl Shipping Column -->
        <ng-container matColumnDef="internationalShippingPrice">
          <th mat-header-cell *matHeaderCellDef>International Shipping</th>
          <td mat-cell *matCellDef="let listing"> {{listing.internationalShippingPrice}} </td>
        </ng-container>

        <!-- Fee Column -->
        <ng-container matColumnDef="fee">
          <th mat-header-cell *matHeaderCellDef>Fee</th>
          <td mat-cell *matCellDef="let listing"> {{listing.fee}} </td>
        </ng-container>
      
        <tr mat-header-row *matHeaderRowDef="['title', 'basePrice', 'domesticShippingPrice', 'internationalShippingPrice', 'fee']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['title', 'basePrice', 'domesticShippingPrice', 'internationalShippingPrice', 'fee'];"></tr>
      </table>

      <div class="action-buttons" fxLayoutAlign="space-between center" fxLayoutGap="8px">
        <button mat-button matStepperPrevious>
          <mat-icon class="icon" fontSet="partIcon" fontIcon="part-previous-single"></mat-icon>
          Back
        </button>
        <div fxLayoutAlign="space-between center" fxLayoutGap="8px">
          <div class="fee-info" *ngIf="!!currentestimateFee">
            Publishing fee for {{ filterListingsByPublished.length }} Listings / {{ selectedExpiration }} day(s):
            <strong>
              <span class="big">{{ currentestimateFee.getIntegerPart() }}</span>
              <span *ngIf="currentestimateFee.ifDotExist()">
                <span class="point">.</span>
                <span class="small">{{ currentestimateFee.getFractionalPart() }}</span>
              </span>
            </strong>
            <span class="currency">&ensp;PART</span>
          </div>
          <button mat-raised-button color="primary" (click)="publishListing()">
            <mat-icon class="icon" fontSet="partIcon" fontIcon="part-check"></mat-icon>
            Import &amp; Publish Listings
          </button>
        </div>
      </div>

    </mat-step>

  </mat-horizontal-stepper>
</div>