<app-header>
  <div class="tab-bar">
    <mat-tab-group (selectedTabChange)="changeTab($event.index)" [selectedIndex]="selectedTab">
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon fontIcon="part-cart-2"></mat-icon>
          Your cart
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon fontIcon="part-recipe"></mat-icon>
          Buy Orders
          <!-- FIXME @dev:
          <span class="tag" *ngIf="orderCount > 0">{{ orderCount }}</span-->
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon fontIcon="part-heart-outline"></mat-icon>
          Favourites
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  </div>
</app-header>



<!-- =========== CART =========== -->

<div class="your-cart container-block" *ngIf="tabLabels[selectedTab] == 'cart'">
  <app-page-intro [childPageAlias]="tabLabels[selectedTab]">
    <ng-container page-title>Your Cart</ng-container>
    <ng-container page-content>
      Your Cart info
    </ng-container>
    <ng-container page-help>
      ...
    </ng-container>
  </app-page-intro>

  <app-checkout-process (onOrderPlaced)="changeTab($event)"></app-checkout-process>
</div><!-- "Your cart" tab -->



<!-- =========== ORDERS =========== -->

<div class="orders container-block" *ngIf="tabLabels[selectedTab] == 'orders'">
  <app-page-intro [childPageAlias]="tabLabels[selectedTab]">
    <ng-container page-title>Buy Orders</ng-container>
    <ng-container page-content>
      This is where you manage the orders you're in the process of buying from other vendors on the marketplace.
    </ng-container>
    <ng-container page-info *ngIf="hasEncryptedWallet">
      As this is an encrypted wallet, your wallet will need to be unlocked in order to process bid update messages!
    </ng-container>
    <ng-container page-help>
      Each step of the purchasing process needs to be confirmed in this page (i.e. marking an order as "Delivered").
    </ng-container>
  </app-page-intro>

  <!--app-orders type="buy"></app-orders-->





  <!-- ------ ↓↓↓ ----------- following code to become shared/orders-overview component ----------- ↓↓↓ ------ -->

  <!-- Orders > Filter -->
  <div class="filter">

    <h2 class="section-title">Search</h2>

    <mat-form-field class="--boxed" appearance="fill">
      <input matInput type="text" [formControl]="searchQuery"
            placeholder="Search Orders" (keyup.escape)="searchQuery.setValue('')">
      <button *ngIf="searchQuery.value.length > 0" matSuffix mat-button class="small" (click)="searchQuery.setValue('')" matTooltip="Clear" matTooltipPosition="after">
        <mat-icon fontIcon="part-clear-all"></mat-icon>
      </button>
      <mat-icon *ngIf="searchQuery.value.length === 0" matSuffix fontIcon="part-search"></mat-icon>
    </mat-form-field>

    <h2 class="section-title">Filter</h2>

    <mat-card class="filter-card">
      <div class="checkbox highlight">
        <mat-checkbox color="primary">Orders requiring action</mat-checkbox><!-- [(ngModel)]="additionalFilter.requiredAttention" (change)="loadOrders()" -->
      </div>
      <div class="checkbox">
        <!-- TODO: change here - instead of "hide completed", we'll do this: hide Completed and Rejected by default, show them when this is checked: -->
        <mat-checkbox color="primary">Show inactive &amp; archived</mat-checkbox><!-- [(ngModel)]="additionalFilter.hideCompleted" (change)="loadOrders()" -->
      </div>

      <mat-divider></mat-divider>

      <mat-radio-group class="radio-group block-radio"><!-- [(ngModel)]="filters.status" (change)="loadOrders()" -->
        <mat-radio-button class="filter-option" *ngFor="let status of statusFilters" value="{{ status.value }}" color="accent" [ngClass]="{ 'empty': status.count === '0' }">
          {{ status.title }}
          <span class="amount">{{ status.count }}</span>
        </mat-radio-button>
      </mat-radio-group>
    </mat-card>

    <button mat-button color="basic" class="clear-filters" (click)="clearAllFilters()">
      <mat-icon fontSet="partIcon" fontIcon="part-clear-all"></mat-icon>
      Clear all filters
    </button>

  </div><!-- .filter -->


  <!-- Orders > list -->
  <div class="orders section with-filter">

    <!-- *ngIf="orders?.length === 0" -->
    <div class="no-results">
      <img class="illustration" src="./assets/images/illustrations/no-orders.svg" alt="No Orders found">
      <p>
        You don't have any market orders yet
      </p>
      <p class="help-text">
        Visit the Marketplace and start buying or selling today!
      </p>
    </div>

    <!-- when searching/filtering: -->
    <div class="no-results">
      <img class="illustration" src="./assets/images/illustrations/no-orders.svg" alt="No Orders found">
      <p>
        No Orders found
      </p>
      <p class="help-text">
        You don't have any Orders matching your search/filter
      </p>
    </div>

    <!--app-order-item *ngFor="let order of orders" [order]="order" (onOrderUpdated)="orderItemUpdated($event)"></app-order-item-->

    <!-- ------ ↓↓↓ ------ following code to become shared/orders-overview/order-item component ------ ↓↓↓ ------ -->

    <mat-expansion-panel class="order list-item no-padding">
      <mat-expansion-panel-header class="header">
        <div class="header-wrapper" fxLayout="row" fxLayoutAlign="space-between center">
          <div class="photo">
            <img src="./assets/images/placeholder_4-3.jpg"><!-- src="{{ listingImage }}" -->
          </div>
          <div class="meta" fxFlex="1 1 100%">
            <div class="name">
              Order name<!--{{ title }}-->
              <!-- TODO: replace with buy quantity when implemented -->
              <span class="qty">&times;1</span>
            </div>
            <div class="hash id">12<!--{{ order?.OrderItem?.id }}--></div>
            <div class="hash" [ngStyle]="{'background-color': '#' + order?.hashDetail}">FS13<!--{{ order?.hash }}--></div>
            <div class="origin-market">
              <!-- TODO: implement display of Market where item was bought -->
              Particl Open Marketplace
            </div>
          </div>
          <div class="status-wrap" fxFlex="0 0 140px">
            <div class="status bidding"><!-- remove "bidding" class, add: {{ order?.step }} {{ order?.type }} -->
              <span class="dot"></span> bidding<!-- {{ order?.step }} -->
            </div>
          </div>
        </div>
      </mat-expansion-panel-header>
    
      <div class="status-info">
        <div class="text">
          <h2 class="item-title">Order #12<!--{{ order?.OrderItem?.id }}--></h2>
          <p>Order has been paid for and it's waiting for Seller to package and ship it to you<!--{{ orderActivity?.status_info }}--></p>
        </div>
        <p class="item-info">
          ID: FS1351FD5<!--{{ order?.hashDetail }}--><br>
          Updated: 2020-04-06 16:05<!--{{order?.updated}}--><br>
          Created: 2020-04-01 21:43<!--{{order?.added}}-->
        </p>
      </div><!-- .status-info -->
    
      <div class="progress-graph" fxLayout>
        <!-- TODO: finished steps as `.done` -->
        <div class="bidding step done" fxFlex>
          <div class="value">Bidding</div>
          <div class="dot"></div>
        </div>
        <div class="payment step done" fxFlex>
          <div class="value">Payment</div>
          <div class="dot"></div>
        </div>
        <!-- TODO: active steps as `.active` -->
        <div class="escrow step active" fxFlex>
          <div class="value">Escrow Lock</div>
          <div class="dot"></div>
        </div>
        <!-- TODO: future steps as `.upcoming` -->
        <div class="packaging step upcoming" fxFlex>
          <div class="value">Packaging</div>
          <div class="dot"></div>
        </div>
        <div class="shipping step upcoming" fxFlex>
          <div class="value">Shipping</div>
          <div class="dot"></div>
        </div>
        <!-- TODO: when order is completed, keep this Completed step as `.active` -->
        <div class="completed step upcoming" fxFlex>
          <div class="value">Completed</div>
          <div class="dot"></div>
        </div>
      </div>
      
      <!-- TODO: when rejected, mark Bidding as `.rejected` (obviously show only Bidding & Rejected steps) -->
      <!--div class="progress-graph" fxLayout>
        <div class="bidding step rejected" fxFlex>
          <div class="value">Bidding</div>
          <div class="dot"></div>
        </div>
        <div class="rejected step" fxFlex>
          <div class="value">Rejected</div>
          <div class="dot"></div>
        </div>
      </div-->
    
      <div class="detail">

        <div class="highlights"><!-- TODO: show only if anything below is active: -->
          <table>
            <tr><!-- *ngIf="showShippingInfo" -->
              <th>Shipping details</th>
              <!--td>{{ memo }}</td--><!-- *ngIf="(memo.length > 0)" -->
              <td><em>Seller didn't provide any additional info</em></td><!-- *ngIf="!(memo.length > 0)" -->
            </tr>
            <tr><!-- *ngIf="additionalInfo.transactionID.length > 0" -->
              <th>Escrow TXID</th>
              <td>
                <div class="txid">
                  <a href="https://explorer.particl.io/tx/45baea1e0362b8eaf2d06e680c1b75ec43101a1573b558725abaa21c754d4068" target="_blank" title="Open in Block Explorer"><!--{{ additionalInfo.transactionID }}-->45baea1e0362b8eaf2d06e680c1b75ec43101a1573b558725abaa21c754d4068</a>
                </div>
              </td>
            </tr>
            <tr><!-- *ngIf="additionalInfo.rejectMessage.length > 0" -->
              <th>Rejected for</th>
              <td><!--{{ additionalInfo.rejectMessage }}-->Not in stock</td>
            </tr>
          </table>
        </div><!-- .highlights -->

        <div class="item-details" fxLayout fxLayoutGap="30px">

          <div class="buyer-info" fxFlex="auto">
            <h3 class="item-subtitle">Shipping details</h3>
            <!--app-shipping-address [shippingAddress]="order?.ShippingAddress"></app-shipping-address-->
            <p class="shipping-info">
              Martin Allien<small>&ndash; Name</small><br>
              Staking Lane 324/Q4<small>&ndash; Street</small><br>
              Cryptocity<small>&ndash; City</small><br>
              Blockstate<small>&ndash; State</small><br>
              5135-46<small>&ndash; ZIP</small><br>
              Somewhereville<small>&ndash; Country</small>
            </p>
            <p class="contact-info"><!-- *ngIf="(contactDetails.email.length > 0) || (contactDetails.phone.length > 0)" -->
              <span><!-- *ngIf="(contactDetails.email.length > 0)" -->
                <a href="mailto:my.name@buyer-central.com">my.name@buyer-central.com</a><!--{{contactDetails.email}}-->
              </span>
              <br>
              <span><!-- *ngIf="(contactDetails.phone.length > 0)" -->
                +548 1843 1548 3511<!--{{contactDetails.phone}}-->
              </span>
            </p>
          </div><!-- .buyer-info -->
      
          <div class="pricing-info" fxFlex="auto">
            <h3 class="item-subtitle">Pricing</h3>
            <table class="prices">
              <tfoot>
                <tr>
                  <th></th>
                  <th><span matTooltip="Particl" matTooltipPosition="below">PART</span></th>
                  <!--th><span matTooltip="US Dollar" matTooltipPosition="below">USD</span> // TODO: replace with user selected fiat countervalue currency (when implemented) </th-->
                </tr>
              </tfoot>
              <tbody>
                <!-- TODO: all amounts will be rounded and forced to 4 decimals again (the former split to whole numbers and decimals is not needed) -->
                <tr>
                  <th>Price (&times;1 item)<!-- TODO: when implemented, replace with buy quantity --></th>
                  <td class="amount part">4.2130<!--{{ pricingInfo.baseInt }}{{ pricingInfo.baseSep }}<small>{{ pricingInfo.baseFraction }}</small>--></td>
                  <!--td class="amount fiat">3.4100</td-->
                </tr>
                <tr>
                  <th>Shipping</th>
                  <td class="amount part">2.5300<!--{{ pricingInfo.shippingInt }}{{ pricingInfo.shippingSep }}<small>{{ pricingInfo.shippingFraction }}</small>--></td>
                  <!--td class="amount fiat">0.8400</td-->
                </tr>
                <tr class="total">
                  <th>Total price</th>
                  <td class="total amount part">13.4860<!--{{ pricingInfo.totalInt }}{{ pricingInfo.totalSep }}<small>{{ pricingInfo.totalFraction }}</small>--></td>
                  <!--td class="total amount fiat">8.5000</td-->
                </tr>
                <tr class="escrow">
                  <th>Escrow payment</th>
                  <td class="escrow amount part">6.7430<!--{{ pricingInfo.escrowInt }}{{ pricingInfo.escrowSep }}<small>{{ pricingInfo.escrowFraction }}</small>--></td>
                  <!--td class="escrow amount fiat">4.2500</td-->
                </tr>
              </tbody>
            </table>
            <p>
              Escrow payment will be automatically returned after sucessfull completion of the Order.
            </p>
          </div><!-- .info -->

        </div><!-- .item-details -->
      </div><!-- .detail -->
    
      <mat-action-row class="action-buttons" fxLayout fxLayoutAlign="space-between stretch">
        <div class="left">
          <button *ngFor="let actionable of secondaryActions"
                  mat-button color="{{actionable.colour}}"
                  [disabled]="actionable.disabled || actionable.locked"
                  appDebounceClick
                  (debounceClick)="executeAction(actionable)"
                  class="small">
            <mat-icon fontSet="partIcon" fontIcon="{{actionable.icon}}"></mat-icon>
            {{ actionable.text }}
          </button>
    
        </div>
        <div class="right">
          <button *ngFor="let actionable of primaryActions"
                  mat-raised-button color="{{actionable.colour}}" matTooltip="{{ actionable.tooltip }}"
                  [disabled]="actionable.disabled || actionable.locked"
                  appDebounceClick
                  (debounceClick)="executeAction(actionable)">
            <mat-icon fontSet="partIcon" fontIcon="{{ actionable.icon }}"></mat-icon>
            {{ actionable.text }}
          </button>
        </div>
      </mat-action-row>
    </mat-expansion-panel>
    
    <!-- ------ ↑↑↑ -------- above code to become shared/orders-overview/order-item component -------- ↑↑↑ ------ -->

  </div><!-- .orders.list -->


  <!-- ------ ↑↑↑ ------------- above code to become shared/orders-overview component ------------- ↑↑↑ ------ -->





</div><!-- "Orders" tab -->



<!-- =========== FAVORITES =========== -->

<div class="favorites container-block"
     *ngIf="tabLabels[selectedTab] == 'favourites'">

  <app-page-intro [childPageAlias]="tabLabels[selectedTab]">
    <ng-container page-title>Your Favourites</ng-container>
    <ng-container page-content>
      Save your favourite Listings to easily access them later on.
    </ng-container>
    <ng-container page-help>
      Note that marketplace Listings have a limited lifetime (they expire after some time), so make sure to check back here often as they might not be available on the marketplace anymore.
    </ng-container>
  </app-page-intro>

  <div class="no-results" *ngIf="favorites === undefined || favorites?.length == 0">
    <img class="illustration" src="./assets/images/illustrations/no-favorites.svg" alt="No favorites yet">
    <p>
      You don't have any favourites yet
    </p>
    <p class="help-text">
      To add an item to favourites, click on the <mat-icon fontIcon="part-heart-outline-add"></mat-icon> icon
    </p>
  </div><!-- .no-results -->

  <div *ngIf="favorites !== undefined && favorites.length != 0" class="grid-container">
    <ng-container *ngFor="let favorite of favorites">

      <mat-card class="listing">
        <app-listing-item [listing]="favorite"></app-listing-item>
      </mat-card>

    </ng-container>
  </div>

</div><!-- "Favorites" tab -->
