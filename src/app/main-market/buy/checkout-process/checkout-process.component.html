<div class="container-block">

  <!-- =========== YOUR CART =========== -->
  
  <form>

    <app-page-intro><!-- [childPageAlias]="tabLabels[selectedTab]" -->
      <ng-container page-title>Your Cart</ng-container>
      <ng-container page-help>
        Manage items in your Cart and submit your Order(s) when you're satisfied.
      </ng-container>
    </app-page-intro>

    <section class="cart">

      <div class="cart-header --cart-layout">
        <div class="photo">Preview</div>
        <div class="title">Title</div>
        <div class="price">Price</div>
        <div class="qty">Qty</div>
        <div class="shipping">Shipping</div>
        <div class="total">Total</div>
        <div class="remove"></div>
      </div>

      <mat-card class="cart-item --cart-layout">
        <!-- TODO: on `.photo` click, open Listing detail modal: -->
        <div class="photo">
          <div class="overlay">
            <mat-icon fontIcon="part-zoom-in"></mat-icon>
          </div>
          <img src="./assets/images/placeholder_4-3.jpg">
        </div>
        <div class="title">
          <!-- TODO: on `H3` click, open Listing detail modal: -->
          <h3 class="name">Listing name goes here</h3>
          <div class="meta">
            <span class="market">Particl Open Marketplace</span>
            <span class="category">Furniture Things</span>
          </div>
          <div class="info">
            <span class="expires-soon">Expires soon!</span>
            <span class="expired">Sorry, this Listing already expired</span>
          </div>
        </div>
        <div class="price">
          <span class="amount part">5<small>.3513</small> P</span>
          <span class="amount fiat">1<small>.6413</small> $</span>
        </div>
        <div class="qty">1 &times;</div>
        <div class="shipping">
          <span class="amount part">0<small>.3513</small> P</span>
          <span class="amount fiat">0<small>.1413</small> $</span>
        </div>
        <div class="total">
          <span class="amount part">7<small>.3513</small> P</span>
          <span class="amount fiat">2<small>.6413</small> $</span>
        </div>
        <div class="remove">
          <button mat-button class="tiny icon-only" color="warn" matTooltip="Remove from Cart">
            <mat-icon fontIcon="part-circle-remove"></mat-icon>
          </button>
        </div>
      </mat-card><!-- .cart-item -->

      <!-- Another one, just for testing (it's the same, can be removed) -->
      <mat-card class="cart-item --cart-layout">
        <!-- TODO: on `.photo` click, open Listing detail modal: -->
        <div class="photo">
          <div class="overlay">
            <mat-icon fontIcon="part-zoom-in"></mat-icon>
          </div>
          <img src="./assets/images/placeholder_4-3.jpg">
        </div>
        <div class="title">
          <!-- TODO: on `H3` click, open Listing detail modal: -->
          <h3 class="name">This one is a bit more longer than the other..</h3>
          <div class="meta">
            <span class="market">Sneaky Market Longer As Well</span>
            <span class="category">Oh, what would we do</span>
          </div>
          <div class="info">
            <span class="expires-soon">Expires soon!</span>
            <span class="expired">Sorry, this Listing already expired</span>
          </div>
        </div>
        <div class="price">
          <span class="amount part">55841<small>.3513</small> P</span>
          <span class="amount fiat">1151<small>.6413</small> $</span>
        </div>
        <div class="qty">1 &times;</div>
        <div class="shipping">
          <span class="amount part">6510<small>.3513</small> P</span>
          <span class="amount fiat">2510<small>.1413</small> $</span>
        </div>
        <div class="total">
          <span class="amount part">8237<small>.3513</small> P</span>
          <span class="amount fiat">3512<small>.6413</small> $</span>
        </div>
        <div class="remove">
          <button mat-button class="tiny icon-only" color="warn" matTooltip="Remove from Cart">
            <mat-icon fontIcon="part-circle-remove"></mat-icon>
          </button>
        </div>
      </mat-card><!-- .cart-item -->

    </section><!-- .cart -->

    <div [hidden]="cart?.countOfItems === 0">
      <!--table class="cart-items">

        <tbody>
        <tr *ngFor="let listing of cart?.listings" [ngClass]="{expired: checkExpired(listing)}">
          <td class="item" fxLayout="row" fxLayoutGap="10px" fxLayoutAling="start center"
              (click)="openListing(listing)">
            <div class="image" fxFlex="0 0 75px">
              <img src="{{listing.imageCollection?.featuredImage?.thumbnail}}">
            </div>
            <div class="info" fxFlex="1 1 100%" fxLayout="column" fxLayoutAlign="center start">
              <div class="title">
                {{listing.title}}
              </div>
              <div class="error message" *ngIf="listing.errorMessage">
                <mat-icon fontSet="partIcon" fontIcon="part-alert"></mat-icon>
                {{listing.errorMessage}}
              </div>
              <div class="warning message" *ngIf="listing.isAboutToExpire">
                <mat-icon fontSet="partIcon" fontIcon="part-circle-alert"></mat-icon>
                Listing expires in {{listing.expireIn}}
              </div>
              <div class="category" *ngIf="!listing.errorMessage && !listing?.isAboutToExpire">
                {{listing.category.name}}
              </div>
            </div>
          </td>
          <td class="price cell">
            {{listing.basePrice?.particlStringInteger()}}{{listing.basePrice?.particlStringSep()}}<small>{{listing.basePrice?.particlStringFraction()}}</small>
            PART
          </td>
          <td *ngIf="listCache?.selectedCountry" class="price cell">
            {{ listing.shippingAmount(listCache?.selectedCountry?.iso)?.particlStringInteger()}}{{listing.shippingAmount(listCache?.selectedCountry?.iso)?.particlStringSep()}}<small>{{listing.shippingAmount(listCache?.selectedCountry?.iso)?.particlStringFraction()}}</small>
            PART
          </td>
          <td *ngIf="!listCache?.selectedCountry" class="total cell">
            {{listing.basePrice?.particlStringInteger()}}{{listing.basePrice?.particlStringSep()}}<small>{{listing.basePrice?.particlStringFraction()}}</small>
            PART
          </td>
          <td *ngIf="listCache?.selectedCountry" class="total cell">
            {{ listing.total(listCache?.selectedCountry?.iso)?.particlStringInteger()}}{{listing.total(listCache?.selectedCountry?.iso)?.particlStringSep()}}<small>{{listing.total(listCache?.selectedCountry?.iso)?.particlStringFraction()}}</small>
            PART
          </td>
          <td class="remove">
            <button mat-button color="warn" class="small" matTooltip="Remove from cart" matTooltipPosition="above"
                    (click)="removeFromCart(listing?.id)">
              <mat-icon fontIcon="part-circle-remove"></mat-icon>
            </button>
          </td>
        </tr>
        </tbody>
      </table-->

      <!--div class="order-detail" fxLayout fxLayoutAlign="space-between start">
        <div class="subtotal-notice" fxFlex="0 1 500px">
          {{ listCache?.selectedCountry ? (
            "Subtotal doesn't include escrow costs. You can review these in the summary before placing your order."
          ) : (
            "Subtotal doesn't include shipping and escrow costs. You can review these in the summary before placing your order."
          )}}
        </div>
        <table class="subtotals" fxFlex="0 0 250px">
          <tr>
            <td class="desc total">Subtotal</td>
            <td *ngIf="!listCache?.selectedCountry" class="value total">
              {{ cart?.getSubTotalWithoutShipping().particlsString() }} PART
            </td>
            <td *ngIf="listCache?.selectedCountry" class="value total">
              {{ cart?.getSubTotalWithShippingTotal(listCache?.selectedCountry?.iso)?.particlsString() }} PART
            </td>
          </tr>
        </table>
      </div--><!-- .order-detail -->

      <div class="action-buttons" fxLayoutAlign="space-between center" fxLayoutGap="8px">
        <button mat-button (click)="clearCart()">
          <mat-icon fontIcon="part-clear-all"></mat-icon>
          Clear cart
        </button>
      </div>
    </div>


    <!-- =========== SHIPPING & PRICING =========== -->
    
    <div class="shipping-pricing" fxLayout="row">
      
      <section class="shipping" fxFlex="60%">

        <div class="section-header">
          <h2>Shipping details</h2>
          <p>Choose an address where your Order should be delivered</p>
          <p class="help-text">You can save your frequently used addresses to your private Shipping profiles</p>
        </div><!-- .section-header -->

        <mat-card>
          <div class="title">Choose shipping profile</div>
          <mat-form-field class="full-width">
            <mat-select matNativeControl [(value)]="selectedAddress" [(ngModel)]="selectedAddress" name="selectedAddress"  [ngModelOptions]="{standalone: true}"
                        (selectionChange)="select(selectedAddress)"
                        placeholder="Select saved shipping address profile"
                        [disabled]="!profile?.shippingAddresses || profile?.shippingAddresses.length === 0">
              <!-- TODO: add a new option (e.g. "Fill address manually"), which would deselect previously selected profile (so that user can go back to manually filling out the address) -->
              <mat-option *ngFor="let address of profile?.shippingAddresses"
                          [value]="address" >
                {{address.title}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <div class="title">Enter shipping address</div>
          <div class="row" fxLayout fxLayoutGap="30px">
            <!-- FIXME: First and Last name should be required as well (waiting for dapp shell integration) -->
            <mat-form-field class="full-width" fxFlex>
              <input matInput placeholder="First name"><!-- formControlName="firstName" -->
            </mat-form-field>
            <mat-form-field class="full-width" fxFlex>
              <input matInput placeholder="Last name"><!-- formControlName="lastName" -->
            </mat-form-field>
          </div>
          <mat-form-field class="full-width">
            <input matInput placeholder="Address line 1"><!-- formControlName="addressLine1" -->
          </mat-form-field>
          <mat-form-field class="full-width">
            <input matInput placeholder="Address line 2"><!-- formControlName="addressLine2" -->
          </mat-form-field>
          <mat-form-field class="full-width">
            <input matInput placeholder="City"><!-- formControlName="city" -->
          </mat-form-field>
          <div class="row" fxLayout fxLayoutGap="30px">
            <mat-form-field class="full-width" fxFlex>
              <input matInput placeholder="ZIP / Postal code"><!-- formControlName="zipCode" -->
            </mat-form-field>
            <mat-form-field class="full-width" fxFlex>
              <input matInput placeholder="State"><!-- formControlName="state" -->
            </mat-form-field>
          </div>

          <!-- <mat-form-field class="full-width">
            <mat-select formControlName="country" placeholder="Country">
              <mat-option *ngFor="let country of countryList.getList()" value="{{country.iso}}">{{country.name}}
              </mat-option>
            </mat-select>
          </mat-form-field> -->

          <mat-select-search
            [showValueOf]="'name'"
            [placeHolder]="'Select Country'"
            [isRequired]="'true'"
            [defaultSelectedValue]="selectedCountry"
            [isLexigraphicalOrder]="true"
            (onChange)="onCountryChange($event)">
          </mat-select-search><!-- [options]= "countryList.getList()" -->

          <!--Hide shipping profile -->
          <div class="sub-section" fxLayout fxLayoutGap="30px" fxLayoutAlign="center center">
            <mat-checkbox fxFlex>{{ selectedAddress?.id ? 'Update' : 'Save' }} shipping profile
            </mat-checkbox><!-- formControlName="newShipping" -->
            <mat-form-field class="full-width" fxFlex>
              <input matInput placeholder="Shipping profile name"><!-- formControlName="title" -->
            </mat-form-field>
          </div>

        </mat-card>
      </section><!-- .shipping -->

      <section class="pricing" fxFlex="40%">

        <div class="section-header">
          <h2>Pricing overview</h2>
          <p>Review pricing of your Order, before you submit it</p>
          <!--p class="help-text">You can save your frequently used addresses to your private Shipping profiles</p-->
        </div><!-- .section-header -->

        <mat-card>
          pricing here
        </mat-card>

      </section><!-- .pricing -->

    </div><!-- .shipping-pricing -->


    <div class="action-buttons" fxLayoutAlign="space-between center" fxLayoutGap="8px">
      <button mat-button>
        <mat-icon fontIcon="part-previous-single"></mat-icon>
        Back to cart
      </button>
      <button mat-raised-button color="primary" (click)="moveToConfirmation()"><!-- [disabled]="!shippingFormGroup.valid" -->
        <mat-icon fontIcon="part-next-single"></mat-icon>
        Continue to confirmation
      </button>
    </div>
  </form>


  <!-- =========== CONFIRM & PLACE ORDER =========== -->

  <form class="confirmation">
    <table class="cart-items summary">
      <thead>
      <tr>
        <th>Items</th>
        <th>Price</th>
        <th>Shipping</th><!--<th>Quantity</th>-->
        <th class="text-right">Total</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let listing of cart?.listings">
        <td class="item" fxLayout="row" fxLayoutGap="10px" fxLayoutAling="start center"
            (click)="openListing(listing)">
          <div class="image" fxFlex="0 0 75px">
            <img src="{{listing.imageCollection?.featuredImage?.thumbnail}}">
          </div>
          <div class="info" fxFlex="1 1 100%" fxLayout="column" fxLayoutAlign="center start">
            <div class="title">
              {{listing.title}}
            </div>
            <div class="category">
              {{listing.category.name}}
            </div>
          </div>
        </td>
        <td class="price cell">
          {{listing.basePrice?.particlStringInteger()}}{{listing.basePrice?.particlStringSep()}}<small>{{listing.basePrice?.particlStringFraction()}}</small>
          PART
        </td>
        <td class="shipping cell">{{listing?.shippingAmount(country)?.particlStringInteger()}}{{listing?.shippingAmount(country)?.particlStringSep()}}<small>{{listing?.shippingAmount(country)?.particlStringFraction()}}</small>
          PART
        </td>
        <!--<td class="quantity cell">1 &times;</td>-->
        <td class="total cell">{{listing?.total(country)?.particlStringInteger()}}{{listing?.total(country)?.particlStringSep()}}<small>{{listing?.total(country)?.particlStringFraction()}}</small>
          PART
        </td>
      </tr>
      </tbody>
    </table>

    <div class="order-detail" fxLayout fxLayoutAlign="space-between start" fxLayoutGap="35px">
      <div class="shipping-overview" fxFlex="1 1 100%">
        <div class="title">Shipping address</div>
        <app-shipping-address></app-shipping-address><!-- [shippingAddress]="shippingFormGroup.value" -->
      </div>
      <table class="subtotals" fxFlex="0 0 250px">
        <tr>
          <td class="desc">Subtotal</td>
          <td class="value">{{cart?.getSubTotalWithoutShipping().particlsString()}} PART</td>
        </tr>
        <tr>
          <td class="desc">Shipping total</td>
          <td class="value">{{cart?.getShippingTotal(country).particlsString()}} PART</td>
        </tr>
        <tr>
          <td class="desc">Escrow</td>
          <td class="value">{{cart?.getEscrowTotal(country).particlsString()}} PART</td>
        </tr>
        <tr>
          <td class="desc total">Total</td>
          <td class="value total">{{cart?.getTotal(country).particlsString()}} PART</td>
        </tr>
      </table>

    </div><!-- .order-detail -->

    <div class="action-buttons" fxLayoutAlign="space-between center" fxLayoutGap="8px">
      <button mat-button (click)="backToShippingDetails()">
        <mat-icon fontIcon="part-previous-single"></mat-icon>
        Back to shipping
      </button>
      <button mat-raised-button color="primary" (click)="placeOrderModal()"><!-- placeOrder() moved to the modal -->
        <mat-icon fontIcon="part-next-single"></mat-icon>
        Place order
      </button>
    </div>
  </form>


</div><!-- container-block -->
