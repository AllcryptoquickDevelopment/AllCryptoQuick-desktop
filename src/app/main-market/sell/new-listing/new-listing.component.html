<div class="container-block">

  <app-page-intro>
    <ng-container page-title>Add new Listing</ng-container>
    <ng-container page-content>
      Publish a new Product for sale on Particl Open Marketplace or any other Markets you've joined.
    </ng-container>
    <ng-container page-help>
      To join or create new Markets, go to "Manage Markets" page.
    </ng-container>
  </app-page-intro>

  <form [formGroup]="templateForm">
    <div class="row" fxLayout="row" fxLayoutGap="30px">

      <div class="left column" fxFlex="50">

        <h2 class="section-title">Product details</h2>
        <mat-card class="details no-padding">

          <label>
            <mat-form-field appearance="fill" class="--plain --larger">
              <h3 class="label">Product name</h3>
              <input matInput #title placeholder="Short and descriptive" formControlName="title">
              <mat-hint align="end">{{ title.value.length }}/{{MAX_TITLE}}</mat-hint>
            </mat-form-field>
          </label>

          <label>
            <mat-form-field appearance="fill" class="textarea --plain --larger">
              <h3 class="label">Summary</h3>
              <textarea matInput #summary rows="3" placeholder="Short Product summary" formControlName="shortDescription"></textarea>
              <mat-hint align="end">{{ summary.value.length }}/{{MAX_SHORT_DESCRIPTION}}</mat-hint>
            </mat-form-field>
          </label>

          <label>
            <mat-form-field appearance="fill" class="textarea --plain --larger">
              <h3 class="label">Full description</h3>
              <textarea matInput #description rows="12" placeholder="In-depth description of your Product" formControlName="longDescription"></textarea>
              <mat-hint align="end">{{ description.value?.length }}/{{MAX_LONG_DESCRIPTION}}</mat-hint>
            </mat-form-field>
          </label>

        </mat-card><!-- .details -->

      </div><!-- .left -->


      <div class="right column" fxFlex="50">

        <h2 class="section-title">Product gallery</h2>
        <mat-card class="photos">
          <div class="drag-n-drop" #dropArea>
            <input class="file-input" type="file" accept="image/*" multiple="true" #fileInputSelector>
            <button mat-button color="primary" (click)="addImage()">
              <mat-icon fontIcon="part-select"></mat-icon>
              Upload photos
            </button>
            <p>or drag'n'drop here</p>
          </div>
          <p class="help-text">
            Upload high quality photos of your Product with good lighting and ideally with white background only. Square format (1:1) works best, with max size of 2 MB.
          </p>
          <div class="gallery">

            <div *ngFor="let image of images.value" class="photo-wrapper">
              <img src="{{ image.url }}">
              <div class="icons">
                <mat-icon class="delete" fontIcon="part-cross" matTooltip="Remove image" (click)="removeExistingImage(image.id)">
                </mat-icon>
                <!--mat-icon class="featured" fontIcon="part-check" matTooltip="Set as featured" (click)="featurePicture(i)">
                </mat-icon-->
              </div>
            </div>

            <div *ngFor="let picture of imagesPending.value ; index as i" class="photo-wrapper">
              <!-- TODO: maybe not gif, but removing is 'unsafe' -->
              <img src="{{ picture }}">
              <div class="icons">
                <mat-icon class="delete" fontIcon="part-cross" matTooltip="Remove image" (click)="removePendingImage(i)">
                </mat-icon>
                <!--mat-icon class="featured" fontIcon="part-check" matTooltip="Set as featured" (click)="featurePicture(i)">
                </mat-icon-->
              </div>
            </div>

          </div><!-- .gallery -->
        </mat-card><!-- .photos -->


        <h2 class="section-title">Pricing <!--&amp; Quantity--></h2>
        <mat-card class="pricing no-padding">

          <div class="row"><!-- fxLayout fxLayoutAlign="stretch end" -->
            <div class="half"><!-- fxFlex="49%" -->
              <label class="--larger">
                <h3 class="label">Product price</h3>
                <mat-form-field appearance="fill" class="--plain --larger">
                  <span matPrefix>PART</span>
                  <input matInput type="text" formControlName="basePrice" type="text" placeholder="price per 1 item">
                </mat-form-field>
              </label>
            </div>
            <!--div class="asymp" fxFlex="2%">
              <span>&asymp;</span>
            </div>
            <div class="half" fxFlex="49%">
              <label class="--larger">
                <h3 class="label">&nbsp;</h3>
                <mat-form-field appearance="fill" class="--plain --larger">
                  <span matPrefix>USD</span>
                  <input matInput type="number" min="0.00000001" (paste)="numericValidator($event)" (keypress)="numericValidator($event)" placeholder="price per 1 item">
                </mat-form-field>
              </label>
            </div-->
          </div>

          <!-- <label class="--larger">
            <h3 class="label">Quantity</h3>
            <mat-form-field appearance="fill" class="--plain --larger">
              <span matPrefix>Items in stock:</span>
              <input matInput type="number" placeholder="How many are you selling" min="1">
            </mat-form-field>
          </label> -->

        </mat-card><!-- .pricing -->

      </div><!-- .right -->
    </div><!-- .row (product details) -->


    <div class="row" fxLayout="row" fxLayoutGap="30px">

      <div class="left column" fxFlex="50">
        <h2 class="section-title">Shipping from</h2>
        <mat-card class="shipping no-padding">

          <label class="--larger">
            <h3 class="label">Shipping from</h3>
            <p class="label-desc">From which country will you be shipping your product</p>
            <tree-select *ngIf="(regionList$ | async).length > 0"
              [data$]="regionList$"
              [singleSelection]="true"
              [initialSelection]="[sourceRegion.value]"
              placeholderLabel="Shipping from (your country)"
              prefixIcon="part-globe"
              largerInput="true"
              matTooltip="The region from which the item will be shipped" matTooltipPosition="below"
              (onClosed)="sourceRegion.setValue($event[0] || '')">
            </tree-select>
          </label>

          <mat-divider></mat-divider>

          <label class="--larger">
            <h3 class="label">Local shipping</h3>
            <p class="label-desc">Shipping price when sending the item inside your country</p>
          </label>
          <div class="row"><!-- fxLayout fxLayoutAlign="stretch end" -->
            <div class="half"><!-- fxFlex="49%" -->
              <mat-form-field appearance="fill" class="--plain --larger">
                <span matPrefix>PART</span>
                <input matInput type="text" formControlName="priceShipLocal" type="text" placeholder="Local shipping price">
              </mat-form-field>
            </div>
            <!--div class="asymp" fxFlex="2%">
              <span>&asymp;</span>
            </div>
            <div class="half" fxFlex="49%">
              <label class="--larger">
                <mat-form-field appearance="fill" class="--plain --larger">
                  <span matPrefix>USD</span>
                  <input matInput min="0" (paste)="numericValidator($event)" (keypress)="numericValidator($event)" placeholder="shipping price" type="number">
                </mat-form-field>
              </label>
            </div-->
          </div>

        </mat-card>
      </div><!-- .left -->

      <div class="right column" fxFlex="50">
        <h2 class="section-title">Shipping to</h2>
        <mat-card class="shipping no-padding">

          <label class="--larger">
            <h3 class="label">Shipping destinations (optional)</h3>
            <p class="label-desc">Choose available countries for shipping (leave empty for all)</p>
            <tree-select *ngIf="(regionList$ | async).length > 0"
              [data$]="regionList$"
              [singleSelection]="false"
              [initialSelection]="targetRegions.value"
              placeholderLabel="Shipping everywhere"
              prefixIcon="part-airplane"
              largerInput="true"
              matTooltip="The region(s) to which the item can be shipped" matTooltipPosition="below"
              (onClosed)="targetRegions.setValue($event)">
            </tree-select>
          </label>

          <mat-divider></mat-divider>

          <label class="--larger">
            <h3 class="label">International shipping</h3>
            <p class="label-desc">Shipping price for sending the item worldwide</p>
          </label>
          <div class="row"><!-- fxLayout fxLayoutAlign="stretch end" -->
            <div class="half"><!-- fxFlex="49%" -->
              <mat-form-field appearance="fill" class="--plain --larger">
                <span matPrefix>PART</span>
                <input matInput type="text" formControlName="priceShipIntl" type="text" placeholder="Intl shipping price">
              </mat-form-field>
            </div>
            <!--div class="asymp" fxFlex="2%">
              <span>&asymp;</span>
            </div>
            <div class="half" fxFlex="49%">
              <label class="--larger">
                <mat-form-field appearance="fill" class="--plain --larger">
                  <span matPrefix>USD</span>
                <input matInput min="0" (paste)="numericValidator($event)" (keypress)="numericValidator($event)" placeholder="shipping price" type="number">
                </mat-form-field>
              </label>
            </div-->
          </div>

        </mat-card>
      </div><!-- .right -->

    </div><!-- .row (shipping) -->

  </form>


  <p class="message --warning" *ngIf="errorMessage.length > 0">
    <strong>Error:</strong> {{ errorMessage }}
  </p>


  <div class="action-buttons" fxLayout fxLayoutAlign="space-between center">
    <div class="left">
      <button mat-button [routerLink]="['../']" color="warn">
        <mat-icon fontIcon="part-cross"></mat-icon>
        Back to Listings
      </button>
    </div>
    <div class="right" *ngIf="(saveButtonText.length > 0) && (publishButtonText.length > 0)">
      <button [disabled]="templateForm.invalid" mat-button matTooltip="Save template changes" (click)="saveTemplate()">
        <mat-icon fontIcon="part-date"></mat-icon>
        {{ saveButtonText }}
      </button>

      <button [disabled]="templateForm.invalid" mat-raised-button color="primary" (click)="publishTemplate()">
        <mat-icon fontIcon="part-check"></mat-icon>
        {{ publishButtonText }}
      </button>
    </div>
  </div><!-- .action-buttons -->

</div>
